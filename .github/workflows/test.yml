name: My GHA
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
 
jobs:
  test1:
    runs-on: ubuntu-22.04

    strategy:
      matrix:
        external_github_repository: [skip]
        cmd_install: [skip]
        cmd_create_manifest: [skip]
        manifest_path: [skip]
        include:
          - external_github_repository: fmi-basel/gliberal-scMultipleX
            cmd_install: 'python -m pip install -e .[fractal-tasks]'
            cmd_create_manifest: 'python src/scmultiplex/dev/create_manifest.py'
            manifest_path: src/scmultiplex/__FRACTAL_MANIFEST__.json
        exclude:
          - external_github_repository: skip
            cmd_install: skip
            cmd_create_manifest: skip
            manifest_path: skip
    steps:

      - name: Print info
        run: |
          echo 'repo: ${{ matrix.external_github_repository }}' |
          echo 'cmd_install: ${{ matrix.cmd_install }}' |
          echo 'cmd_create_manifest: ${{ matrix.cmd_create_manifest }} |
          echo 'manifest_path: ${{ matrix.manifest_path }}'
          

      # Get package source code
      - uses: actions/checkout@v4
        with:
          repository: ${{ matrix.external_github_repository }}

      # Get Python
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          
      # Install package
      - name: Install package
        run:  ${{ matrix.cmd_install }}

      # Create manifest
      - name: Create manifest
        run: ${{ matrix.cmd_create_manifest }}

      # Run git diff for manifest
      - name: Manifest diff
        run: git diff ${{ matrix.manifest_path }}
        
      - name: Check if there are changes
        id: changes
        uses: UnicornGlobal/has-changes-action@v1.0.11
        
      - name: Process changes
        if: steps.changes.outputs.changed == 1
        run: echo 'Changes exist' && exit 1
